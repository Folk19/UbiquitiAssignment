plugins {
    id("com.avast.gradle.docker-compose") version "0.14.0"
    id 'java'
}

group 'shawn.example'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.7.0'
}

test {
    useJUnitPlatform()
}

dockerCompose {
    useComposeFiles.add("src/test/resources/postgres/docker-compose.yaml")
    isRequiredBy(test)
}

test.doFirst {
    def dbPort = dockerCompose.servicesInfos.database.postgres_db.tcpPorts[5432]
    environment.put("spring.datasource.url", "jdbc:postgresql://localhost:$dbPort/ui_test")
}